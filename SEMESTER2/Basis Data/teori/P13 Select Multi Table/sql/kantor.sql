-- Active: 1714393152209@@127.0.0.1@3306@db_kantor
USE db_kantor;

CREATE TABLE departemen (
    NO_DEP VARCHAR(2) NOT NULL, 
    DEPARTEMEN VARCHAR(50) DEFAULT NULL, 
    LOKASI VARCHAR(50) DEFAULT NULL
);

CREATE TABLE proyek (
    NO_PRO VARCHAR(2) NOT NULL, 
    PROJEK VARCHAR(50) DEFAULT NULL, 
    LOKASI VARCHAR(50) DEFAULT NULL, 
    NO_DEP VARCHAR(2) DEFAULT NULL
);

CREATE TABLE kerja (
    NO_KER VARCHAR(2) NOT NULL, 
    NO_KTP VARCHAR(20) DEFAULT NULL, 
    NO_PRO VARCHAR(2) DEFAULT NULL, 
    LAMA_JAM VARCHAR(2) DEFAULT NULL
);

CREATE TABLE pegawai (
    NO_KTP VARCHAR(20) NOT NULL, 
    PEGAWAI VARCHAR(50) DEFAULT NULL, 
    JENIS_KEL ENUM('1', '2') DEFAULT NULL,
    ALAMAT VARCHAR(50) DEFAULT NULL, 
    TGL_LAHIR DATE DEFAULT NULL,
    GAJI INT(10) DEFAULT NULL, 
    NO_DEP VARCHAR(2) DEFAULT NULL
);

CREATE TABLE tanggungan (
    NO_TANG VARCHAR(2) NOT NULL,
    NO_KTP VARCHAR(20) DEFAULT NULL, 
    TANGGUNGAN VARCHAR(50) DEFAULT NULL, 
    JENIS_KEL ENUM('1', '2') DEFAULT NULL,
    TGL_LAHIR DATE DEFAULT NULL,
    HUBUNGAN VARCHAR(20) DEFAULT NULL
);

INSERT INTO departemen (NO_DEP, DEPARTEMEN, LOKASI) VALUES 
('1', 'KEUANGAN', 'MALANG'),
('2', 'PEMASARAN', 'MALANG'),
('3', 'PRODUKSI', 'MALANG'),
('4', 'TENAGA KERJA', 'MALANG'),
('5', 'IT', 'MALANG');

INSERT INTO proyek (NO_PRO, PROJEK, LOKASI, NO_DEP) VALUES 
('1', 'DESAIN GAMBAR', 'MALANG', '5'),
('2', 'PEMASARAN BARANG', 'MALANG', '3'),
('3', 'JARINGAN KOMPUTER', 'SURABAYA', '4');

INSERT INTO kerja (NO_KER, NO_KTP, NO_PRO, LAMA_JAM) VALUES 
('1', '20104260001', '1', '36'),
('2', '20104340002', '1', '36'),
('3', '20104290001', '2', '60'),
('4', '20104320002', '2', '60'),
('5', '20104270002', '3', '42');

INSERT INTO pegawai (NO_KTP, PEGAWAI, JENIS_KEL, ALAMAT, TGL_LAHIR, GAJI, NO_DEP) VALUES 
('20104260001', 'DODO', '1', 'MALANG', '1987-12-12', '2000000', '1'),
('20104270002', 'NINI', '2', 'SURABAYA', '1989-12-13', '2000000', '2'),
('20104280002', 'NORMAN', '1', 'MALANG', '1979-01-01', '2500000', '2'),
('20104290001', 'LALA', '2', 'MALANG', '1990-03-11', '1750000', '5'),
('20104300002', 'DINDA', '2', 'KEDIRI', '1980-02-15', '2000000', '3'),
('20104310001', 'SONI', '1', 'TULUNGAGUNG', '1970-10-29', '3000000', '4'),
('20104320002', 'NONO', '1', 'SURABAYA', '1986-09-17', '2600000', '5'),
('20104330001', 'DITA', '2', 'MALANG', '1974-03-01', '2000000', '3'),
('20104340002', 'HARI', '1', 'SURABAYA', '1969-11-01', '2900000', '5'),
('20104350002', 'NINO', '1', 'MALANG', '1972-11-10', '2000000', '1');

INSERT INTO tanggungan (NO_TANG, NO_KTP, TANGGUNGAN, JENIS_KEL, TGL_LAHIR, HUBUNGAN) VALUES 
('1', '20104350002', 'HERA', '2', '1972-11-12', 'ISTRI'),
('2', '20104350002', 'RAHEL', '2', '1992-07-17', 'ANAK'),
('3', '20104350002', 'ROKI', '1', '1998-11-12', 'ANAK'),
('4', '20104310001', 'SHINTA', '2', '1972-05-20', 'ISTRI'),
('5', '20104290001', 'DINI', '2', '1990-07-01', 'ANAK');

SELECT * FROM departemen;

-- 1
SELECT d.`DEPARTEMEN`, p.`PEGAWAI`, p.`TGL_LAHIR` FROM departemen d 
  INNER JOIN pegawai p
  ON d.`NO_DEP` = p.`NO_DEP`
  WHERE p.`TGL_LAHIR` = (SELECT MAX(`TGL_LAHIR`) FROM pegawai); 

-- 2
SELECT d.`DEPARTEMEN`, COUNT(p.`NO_DEP`) AS JUMLAH_PEGAWAI
  FROM departemen d 
  LEFT JOIN pegawai p
  ON d.`NO_DEP` = p.`NO_DEP`
  GROUP BY d.`DEPARTEMEN`;

-- 3
SELECT p.`NO_PRO`, p.`PROJEK`, p.`LOKASI`, p.`NO_DEP`,  d.`NO_DEP`, d.`DEPARTEMEN`, d.`LOKASI`
  FROM proyek p
  LEFT JOIN departemen d
  ON p.`NO_DEP` = d.`NO_DEP` ORDER BY p.`NO_PRO` ASC;